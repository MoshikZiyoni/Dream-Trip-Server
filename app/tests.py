# def process_list():

#         my_list = [
#         "London, United Kingdom",
#         "New York City, United States",
#         "Paris, France",
#         "Tokyo, Japan",
#         "Sydney, Australia",
#         "Rome, Italy",
#         "Berlin, Germany",
#         "Moscow, Russia",
#         "Beijing, China",
#         "Toronto, Canada",
#         "Madrid, Spain",
#         "Cairo, Egypt",
#         "Istanbul, Turkey",
#         "Rio de Janeiro, Brazil",
#         "Cape Town, South Africa",
#         "Mumbai, India",
#         "Buenos Aires, Argentina",
#         "Dubai, United Arab Emirates",
#         # "Seoul, South Korea",
#         "Athens, Greece",
#         "Amsterdam, Netherlands",
#         "Prague, Czech Republic",
#         "Vienna, Austria",
#         "Helsinki, Finland",
#         "Bangkok, Thailand",
#         "Singapore, Singapore",
#         "Stockholm, Sweden",
#         "Copenhagen, Denmark",
#         "Budapest, Hungary",
#         "Dublin, Ireland",
#         "Warsaw, Poland",
#         "Lisbon, Portugal",
#         "Oslo, Norway",
#         "Reykjavik, Iceland",
#         "Brasília, Brazil",
#         "Mexico City, Mexico",
#         "Santiago, Chile",
#         "Bogota, Colombia",
#         "Lima, Peru",
#         "Caracas, Venezuela",
#         "Johannesburg, South Africa",
#         "Nairobi, Kenya",
#         "Casablanca, Morocco",
#         "Beirut, Lebanon",
#         "New Delhi, India",
#         "Hanoi, Vietnam",
#         "Manila, Philippines",
#         "Jakarta, Indonesia",
#         "Kuala Lumpur, Malaysia",
#         "Wellington, New Zealand",
#         "San Francisco, United States",
#         "Los Angeles, United States",
#         "Chicago, United States",
#         "Miami, United States",
#         "Boston, United States",
#         "Seattle, United States",
#         "Las Vegas, United States",
#         # "Washington, D.C., United States",
#         "San Diego, United States",
#         "Houston, United States",
#         "Dallas, United States",
#         "Atlanta, United States",
#         "Denver, United States",
#         "Phoenix, United States",
#         "Portland, United States",
#         "Philadelphia, United States",
#         "Vancouver, Canada",
#         "Montreal, Canada",
#         "Calgary, Canada",
#         "Ottawa, Canada",
#         "Edmonton, Canada",
#         "Quebec City, Canada",
#         "Sydney, Canada",
#         "Melbourne, Australia",
#         "Brisbane, Australia",
#         "Perth, Australia",
#         "Adelaide, Australia",
#         "Auckland, New Zealand",
#         "Christchurch, New Zealand",
#         "Wellington, New Zealand",
#         "Mumbai, India",
#         "Delhi, India",
#         "Bangalore, India",
#         "Chennai, India",
#         "Kolkata, India",
#         "Hyderabad, India",
#         "Ahmedabad, India",
#         "Pune, India",
#         "Jaipur, India",
#         "Tokyo, Japan",
#         "Yokohama, Japan",
#         "Osaka, Japan",
#         "Nagoya, Japan",
#         "Sapporo, Japan",
#         "Fukuoka, Japan",
#         "Kyoto, Japan",
#         "Hiroshima, Japan",
#         "Barcelona, Spain",
#         "Valencia, Spain",
#         "Seville, Spain",
#         "Malaga, Spain",
#         "Bilbao, Spain",
#         "Granada, Spain",
#         "Alicante, Spain",
#         "Zaragoza, Spain",
#         "Rome, Italy",
#         "Milan, Italy",
#         "Naples, Italy",
#         "Turin, Italy",
#         "Florence, Italy",
#         "Venice, Italy",
#         "Bologna, Italy",
#         "Genoa, Italy",
#         "Paris, France",
#         "Marseille, France",
#         "Lyon, France",
#         "Toulouse, France",
#         "Nice, France",
#         "Nantes, France",
#         "Strasbourg, France",
#         "Bordeaux, France",
#         "Berlin, Germany",
#         "Hamburg, Germany",
#         "Munich, Germany",
#         "Cologne, Germany",
#         "Frankfurt, Germany",
#         "Stuttgart, Germany",
#         "Düsseldorf, Germany",
#         "Leipzig, Germany",
#         "Vienna, Austria",
#         "Graz, Austria",
#         "Linz, Austria",
#         "Salzburg, Austria",
#         "Innsbruck, Austria",
#         "Klagenfurt, Austria",
#         "Geneva, Switzerland",
#         "Zurich, Switzerland",
#         "Basel, Switzerland",
#         "Lausanne, Switzerland",
#         "Bern, Switzerland",
#         "Lucerne, Switzerland",
#         "St. Gallen, Switzerland",
#         "Moscow, Russia",
#         "Saint Petersburg, Russia",
#         "Novosibirsk, Russia",
#         "Yekaterinburg, Russia",
#         "Nizhny Novgorod, Russia",
#         "Kazan, Russia",
#         "Chelyabinsk, Russia",
#         "Samara, Russia",
#         "Istanbul, Turkey",
#         "Ankara, Turkey",
#         "Izmir, Turkey",
#         "Bursa, Turkey",
#         "Adana, Turkey",
#         "Gaziantep, Turkey",
#         "Konya, Turkey",
#         "Antalya, Turkey",
#         "Beijing, China",
#         "Shanghai, China",
#         "Guangzhou, China",
#         "Shenzhen, China",
#         "Chengdu, China",
#         "Hangzhou, China",
#         "Wuhan, China",
#         "Tianjin, China",
#         "Seoul, South Korea",
#         "Busan, South Korea",
#         "Incheon, South Korea",
#         "Daegu, South Korea",
#         "Daejeon, South Korea",
#         "Gwangju, South Korea",
#         "Ulsan, South Korea",
#         "Athens, Greece",
#         "Thessaloniki, Greece",
#         "Patras, Greece",
#         "Heraklion, Greece",
#         "Larissa, Greece",
#         "Ioannina, Greece",
#         "Volos, Greece",
#         "Amsterdam, Netherlands",
#         "Rotterdam, Netherlands",
#         "The Hague, Netherlands",
#         "Utrecht, Netherlands",
#         "Eindhoven, Netherlands",
#         "Tilburg, Netherlands",
#         "Groningen, Netherlands",
#         "Prague, Czech Republic",
#         "Brno, Czech Republic",
#         "Ostrava, Czech Republic",
#         "Plzen, Czech Republic",
#         "Olomouc, Czech Republic",
#         "Liberec, Czech Republic",
#         "Hradec Kralove, Czech Republic",
#         "Vienna, Austria",
#         "Graz, Austria",
#         "Linz, Austria",
#         "Salzburg, Austria",
#         "Innsbruck, Austria",
#         "Klagenfurt, Austria",
#         "Helsinki, Finland",
#         "Espoo, Finland",
#         "Tampere, Finland",
#         "Vantaa, Finland",
#         "Turku, Finland",
#         "Oulu, Finland",
#         "Lahti, Finland",
#         "Bangkok, Thailand",
#         "Phuket, Thailand",
#         "Chiang Mai, Thailand",
#         "Pattaya, Thailand",
#         "Krabi, Thailand",
#         "Ayutthaya, Thailand",
#         "Samui, Thailand",
#         "Singapore, Singapore",
#         "Stockholm, Sweden",
#         "Gothenburg, Sweden",
#         "Malmo, Sweden",
#         "Uppsala, Sweden",
#         "Vasteras, Sweden",
#         "Orebro, Sweden",
#         "Linkoping, Sweden",
#         "Copenhagen, Denmark",
#         "Aarhus, Denmark",
#         "Odense, Denmark",
#         "Aalborg, Denmark",
#         "Esbjerg, Denmark",
#         "Randers, Denmark",
#         "Kolding, Denmark",
#         "Budapest, Hungary",
#         "Debrecen, Hungary",
#         "Szeged, Hungary",
#         "Miskolc, Hungary",
#         "Pecs, Hungary",
#         "Gyor, Hungary",
#         "Nyiregyhaza, Hungary",
#         "Dublin, Ireland",
#         "Cork, Ireland",
#         "Limerick, Ireland",
#         "Galway, Ireland",
#         "Waterford, Ireland",
#         "Belfast, United Kingdom",
#         "Manchester, United Kingdom",
#         "Birmingham, United Kingdom",
#         "Glasgow, United Kingdom",
#         "Edinburgh, United Kingdom",
#         "Liverpool, United Kingdom",
#         "Leeds, United Kingdom",
#         "Warsaw, Poland",
#         "Krakow, Poland",
#         "Lodz, Poland",
#         "Wroclaw, Poland",
#         "Poznan, Poland",
#         "Gdansk, Poland",
#         "Szczecin, Poland",
#         "Lisbon, Portugal",
#         "Porto, Portugal",
#         "Vila Nova de Gaia, Portugal",
#         "Amadora, Portugal",
#         "Braga, Portugal",
#         "Coimbra, Portugal",
#         "Funchal, Portugal",
#         "Oslo, Norway",
#         "Bergen, Norway",
#         "Stavanger, Norway",
#         "Trondheim, Norway",
#         "Drammen, Norway",
#         "Fredrikstad, Norway",
#         "Sandnes, Norway",
#         "Reykjavik, Iceland",
#         "Brasília, Brazil",
#         "Rio de Janeiro, Brazil",
#         "São Paulo, Brazil",
#         "Salvador, Brazil",
#         "Fortaleza, Brazil",
#         "Belo Horizonte, Brazil",
#         "Manaus, Brazil",
#         "Recife, Brazil",
#         "Mexico City, Mexico",
#         "Guadalajara, Mexico",
#         "Monterrey, Mexico",
#         "Puebla City, Mexico",
#         "Tijuana, Mexico",
#         "Ciudad Juarez, Mexico",
#         "Leon, Mexico",
#         "Santiago, Chile",
#         "Valparaiso, Chile",
#         "Concepcion, Chile",
#         "Antofagasta, Chile",
#         "Vina del Mar, Chile",
#         "Temuco, Chile",
#         "Rancagua, Chile",
#         "Bogota, Colombia",
#         "Medellin, Colombia",
#         "Cali, Colombia",
#         "Barranquilla, Colombia",
#         "Cartagena, Colombia",
#         "Cucuta, Colombia",
#         "Bucaramanga, Colombia",
#         "Lima, Peru",
#         "Arequipa, Peru",
#         "Trujillo, Peru",
#         "Chiclayo, Peru",
#         "Piura, Peru",
#         "Cusco, Peru",
#         "Chimbote, Peru",
#         "Caracas, Venezuela",
#         "Maracaibo, Venezuela",
#         "Valencia, Venezuela",
#         "Barquisimeto, Venezuela",
#         "Maracay, Venezuela",
#         "Ciudad Guayana, Venezuela",
#         "Nairobi, Kenya",
#         "Mombasa, Kenya",
#         "Kisumu, Kenya",
#         "Nakuru, Kenya",
#         "Eldoret, Kenya",
#         "Nyeri, Kenya",
#         "Casablanca, Morocco",
#         "Rabat, Morocco",
#         "Marrakech, Morocco",
#         "Fes, Morocco",
#         "Tangier, Morocco",
#         "Agadir, Morocco",
#         "Beirut, Lebanon",
#         "Tripoli, Lebanon",
#         "Sidon, Lebanon",
#         "Tyre, Lebanon",
#         "Zahle, Lebanon",
#         "New Delhi, India",
#         "Mumbai, India",
#         "Kolkata, India",
#         "Chennai, India",
#         "Bangalore, India",
#         "Hyderabad, India",
#         "Ahmedabad, India",
#         "Pune, India",
#         "Jaipur, India",
#         "Hanoi, Vietnam",
#         "Ho Chi Minh City, Vietnam",
#         "Da Nang, Vietnam",
#         "Haiphong, Vietnam",
#         "Nha Trang, Vietnam",
#         "Can Tho, Vietnam",
#         "Manila, Philippines",
#         "Quezon City, Philippines",
#         "Caloocan, Philippines",
#         "Davao City, Philippines",
#         "Cebu City, Philippines",
#         "Zamboanga City, Philippines",
#         "Jakarta, Indonesia",
#         "Surabaya, Indonesia",
#         "Bandung, Indonesia",
#         "Medan, Indonesia",
#         "Semarang, Indonesia",
#         "Palembang, Indonesia",
#         "Kuala Lumpur, Malaysia",
#         "George Town, Malaysia",
#         "Ipoh, Malaysia",
#         "Shah Alam, Malaysia",
#         "Petaling Jaya, Malaysia",
#         "Malacca City, Malaysia",
#         "Wellington, New Zealand",
#         "Auckland, New Zealand",
#         "Christchurch, New Zealand",
#         "Hamilton, New Zealand",
#         "Tauranga, New Zealand",
#         "Napier, New Zealand",
#         "Dunedin, New Zealand",
#         "San Francisco, United States",
#         "Los Angeles, United States",
#         "Chicago, United States",
#         "Miami, United States",
#         "Boston, United States",
#         "Seattle, United States",
#         "Las Vegas, United States",
#         # "Washington, D.C., United States",
#         "San Diego, United States",
#         "Houston, United States",
#         "Dallas, United States",
#         "Atlanta, United States",
#         "Denver, United States",
#         "Phoenix, United States",
#         "Portland, United States",
#         "Philadelphia, United States",
#         "Vancouver, Canada",
#         "Montreal, Canada",
#         "Calgary, Canada",
#         "Ottawa, Canada",
#         "Edmonton, Canada",
#         "Quebec City, Canada",
#         "Sydney, Canada",
#         "Melbourne, Australia",
#         "Brisbane, Australia",
#         "Perth, Australia",
#         "Adelaide, Australia",
#         "Auckland, New Zealand",
#         "Christchurch, New Zealand",
#         "Wellington, New Zealand",
#         "Christchurch, New Zealand"
#             ]
#         geolocator = Nominatim(user_agent="dream-trip")

#         for item in my_list:
#             city, country = item.split(", ")
#             # print(city)
#             existing_country = Country.objects.filter(name=country).first()
            
#             existing_city = City.objects.filter(name=city)
            
#             if existing_city:
#                 print ('continue')
#                 continue
#             else:

#                 country_id=existing_country.id
#                 wiki=process_query(city)
#                 location = geolocator.geocode(f"{city},{country}")
#                 landmarks = [location.latitude, location.longitude]
#                 city_query = City(country_id=country_id, city=city, latitude=landmarks[0], longitude=landmarks[1], description=wiki[0])
#                 city_query.save()
#                 print ('save successufly')
    
#         print(city,country)
#     thread = Thread(target=process_list)
#     thread.start()
#     exit
#     exit

from dotenv import load_dotenv

from trip_advisor import flickr_api

load_dotenv()


import os
import requests
import json
import time
from geopy.geocoders import Nominatim
from urllib.parse import quote

# def trip_advisor_attraction(city_name,country,landmarks):
#     geolocator = Nominatim(user_agent="dream-trip")
#     key=os.environ.get('TRIP_ADVISOR_KEY')
#     print ('start trip adviosr attractions')
#     url = f"https://api.content.tripadvisor.com/api/v1/location/nearby_search?"
#     headers = {"accept": "application/json"}
#     params = {
#         'searchQuery': f"{city_name},{country}",
#         'latLong': quote(f"{landmarks[0]}, {landmarks[1]}"),  # URL-encode the latLong values
#         'key' : {key},
#         'category': 'attractions',
#         'radius': '10',
#         'radiusUnit':'km',
#         'language' : 'en'
#     }
#     response = requests.get(url, headers=headers, params=params)
#     print(response)
#     result = response.json()
#     attractions = []
#     for attraction in result['data']:
#         address_string = attraction['address_obj']['address_string']
#         address_obj = attraction['address_obj']
#         if 'street1' in address_obj and 'city' in address_obj and 'country' in address_obj:
#             street = address_obj['street1']
#             city_for_attraction = address_obj['city']
#             country = address_obj['country']
#             address_string1 = f"{street}, {city_for_attraction}, {country}"
#             location = geolocator.geocode(address_string1)
#             time.sleep(0.5)
#             latitude = None
#             longitude = None
#             if location is not None:
#                 latitude = location.latitude
#                 longitude = location.longitude
#                 print('Found landmarks for', latitude, longitude)

#             attraction_info = {
#                 'location_ID' : attraction['location_id'],
#                 'name': attraction['name'],
#                 'latitude': latitude,
#                 'longitude': longitude,
#                 'address_string':address_string,
#             }
#             print ('attraction_info save successfuly')
#             attractions.append(attraction_info) 
#     print(attractions)
#     return (attractions)

# trip_advisor_attraction('Asuncion','Paraguay',[25.2637,57.5759])


data={'html_attributions': [], 'results': [{'business_status': 'OPERATIONAL', 'formatted_address': 'Cra. 34 #3a-34, El Sindicato, Cali, Valle del Cauca', 'geometry': {'location': {'lat': 3.4349267, 'lng': -76.5450263}, 'viewport': {'northeast': {'lat': 3.436327679892722, 'lng': -76.54358772010728}, 'southwest': {'lat': 3.433628020107277, 'lng': -76.54628737989273}}}, 'icon': 'https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png', 'icon_background_color': '#FF9E67', 'icon_mask_base_uri': 'https://maps.gstatic.com/mapfiles/place_api/icons/v2/restaurant_pinlet', 'name': 'PARKE 360', 'opening_hours': {'open_now': False}, 'photos': [{'height': 3456, 'html_attributions': ['<a href="https://maps.google.com/maps/contrib/103719269446343341446">ana maria rodriguez</a>'], 'photo_reference': 'AUacShjTZIL0HqMaYk8oWRM0ivNyVUI7LzASWvbBoMJHX0iM2nFfYSPwBdXdBlqBOdNtg00uZsJEeXH9__EgJ2TZAUETF-pPqJh-eN4h0y4BKmG1HAcE9cAZX9qcQTplfz7zd1YQ-0xvJCPx_6v8-cgjPmFo17QyjFhp7C38gHVZh0TgE-J7', 'width': 4608}], 'place_id': 'ChIJw7jvY7anMI4RM4zZKyYN7d4', 'plus_code': {'compound_code': 'CFM3+XX Cali, Valle del Cauca', 'global_code': '67M5CFM3+XX'}, 'price_level': 2, 'rating': 4.6, 'reference': 'ChIJw7jvY7anMI4RM4zZKyYN7d4', 'types': ['restaurant', 'point_of_interest', 'food', 'establishment'], 'user_ratings_total': 1559}, ], 'status': 'OK'}



import concurrent.futures
import requests

# def fetch_photo(photo_reference):
API_KEY = 'AIzaSyAbnt3oN_YRb9fzxvai7xGbPBkgGSTg91U'
#     if photo_reference:
#         initial_url = f"https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference={photo_reference}&key={API_KEY}"
#         response = requests.get(initial_url)
#         return response.url
#     return None
city_list=[{"city": "Puebla City", "city_obj": 670}]
places = []
def process_result(result):
    name = result['name']
    lat = result['geometry']['location']['lat']
    lng = result['geometry']['location']['lng']
    rating = result['rating']
    # if rating==0:
    #         pass
    place_id = result['place_id']
    photo_reference = result['photos'][0]['photo_reference'] if result.get('photos') else None
    html_attributions = result['photos'][0]['html_attributions'] if result.get('photos') else None
    initial_url = f"https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference={photo_reference}&key={API_KEY}"
    response = requests.get(initial_url)
    final_url = response.url
    print (final_url)
    # image = flickr_api(name=name,latitude=lat,longitude=lng)
    # print(name,image)
    place = {
        'name': name,
        'latitude': lat,
        'longitude': lng,
        'review_score': rating,
        'place_id': place_id,
        # 'photo': image,
        'html_attributions': html_attributions,
    }
    places.append(place)


# Process results concurrently
with concurrent.futures.ThreadPoolExecutor() as executor:
    futures = [executor.submit(process_result, result) for result in data['results']]
    concurrent.futures.wait(futures)
    for attraction in places:
        name1 = (attraction['name'])
        # check_name=Attraction.objects.filter(name=name1).first()
        # if not check_name:   
                            
        latitude1 = attraction['latitude']if 'latitude' in attraction else ''
        longitude1 = attraction['longitude']if 'longitude' in attraction else ''
        photos1 = attraction['photos']if 'photos' in attraction else ''
        review_score1 = attraction['review_score']if 'review_score' in attraction else ''
        website1 = attraction['website']if 'website' in attraction else ''
        hours_popular1 = attraction['hours_popular']if 'hours_popular' in attraction else ''
        description = attraction['description']if 'description' in attraction else ''
        distance1 = attraction['distance']if 'distance' in attraction else ''
        city_obj=attraction['city_obj']if 'city_obj' in attraction else ''
        # city_obj=City.objects.filter(id=city_obj).first()

for city_info in city_list:
    city = city_info['city'] 
    city_obj = city_info['city_obj']
    